<meta name="color-scheme" content="dark light">

<style>
	pre { white-space: pre-wrap; }
</style>

<script type="module">
	import { readMetadata, logout, login } from './auth.js';
	import { createBM, getBM, updateBM } from './xbs.js';

	window.logout = logout;
	window.login = login;
	const authRes = await readMetadata();
	console.log(authRes)
	const { password, nickname="", email="" } = authRes;
	const syncId = authRes?.syncId || await createBM();
	
	const loggedIn = syncId && password;

	//await updateBM(bmId, bm);
	loggedIn && (document.body.innerHTML = `
	 <button onclick="logout()">log out</button>
	 <pre>
user: ${nickname}
email: ${email}
bookmarks: ` +
		JSON.stringify(
				await getBM(syncId, password), null, 2
		) + 
	`</pre>
	`);
	
	!loggedIn && (document.body.innerHTML = `<button onclick="login()">log in</button>`);

</script>