<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Boxes and Wires</title>
  <link rel="icon" href="data:,">
  <script src="https://rawgit.com/joewalnes/filtrex/master/filtrex.js"></script>
  <script src="state.js"></script>
  <script src="config.js"></script>
  <script src="wires.js"></script>
  <link rel="stylesheet" href="index.css">
</head>

<body>
  <div id="state-memory-size">do stuff, history grows</div>
  <div id="api-results">- - - -</div>
  <!-- <div>shadrach</div> -->
  <svg id="canvas" preserveAspectRatio="none" viewBox="0 0 500 500" xmlns="http://www.w3.org/2000/svg"
    onload="initScene(evt, boxes, wires)">
    <defs>
      <filter id="outline">
        <feMorphology operator="dilate" in="SourceGraphic" result="DILATED" radius="1" />
        <feFlood flood-color="#aa00aa" flood-opacity="1" result="COLORED"></feFlood>
        <feComposite in="COLORED" in2="DILATED" operator="in" result="OUTLINE"></feComposite>

        <feMerge>
          <feMergeNode in="OUTLINE" />
          <feMergeNode in="SourceGraphic" />
        </feMerge>
      </filter>
    </defs>

    <g id="links">
      <!-- LINKS ARE CREATED DYNAMICALLY -->
    </g>
  </svg>
</body>

<script>
  (function () {
    /* only works with single file immplementation */
    const oldWay = false;
    if(!oldWay){
      return;
    }
    if (!(document.location + '').includes('localhost')) {
      return;
    }
    function getHash(str) {
      return str.split('').reduce((prevHash, currVal) =>
        (((prevHash << 5) - prevHash) + currVal.charCodeAt(0)) | 0, 0);
    }
    var hash;
    function pageIsChanged() {
      fetch(document.location).then(x => x.text()).then(x => {
        const newHash = getHash(x);
        hash = hash || newHash;

        if (hash === newHash) {
          return;
        }
        document.location.reload();
      });
    }

    console.log('=== Simple Live Reload ===');
    var refreshInterval = setInterval(pageIsChanged, 1000);
  })();
</script>

<script>
  (function () {
    if (!(document.location + '').includes('localhost')) {
      return;
    }

    window.reloadVerbose = false;
    const src = 'https://crosshj.com/experiments/rangers/reload-client.js';
    var po = document.createElement('script'); po.type = 'text/javascript';
    po.async = true;
    po.src = src;
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(po, s);
  })();
</script>
