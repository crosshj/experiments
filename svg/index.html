<!--

    NOTES:
    - move towards greater objective-orientation in code

    ISSUES:

    TODO:
    - wires: CRUD
    - boxes: CRUD
    - boxes: indicator on node that it is linked (small dot)
    - wires: animation and indicators (arrows)
    - boxes: collision detection
    - page: zoom/pan with memory
    X creation of scene from json
    - highlighting links

    RESOURCES:
    - path tool - https://codepen.io/thebabydino/full/EKLNvZ
    - path info - https://developer.mozilla.org/en-US/docs/Web/SVG/Tutorial/Paths

-->

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Boxes and Wires Playground</title>
  <script src="config.js"></script>
  <script src="wires.js"></script>
  <link rel="stylesheet" href="index.css">
</head>

<script>
</script>

<svg id="canvas" preserveAspectRatio="none" viewBox="0 0 500 500" xmlns="http://www.w3.org/2000/svg"
  onload="makeDraggable(evt, boxes, wires)">
  <defs>
    <filter id="outline">
      <feMorphology operator="dilate" in="SourceGraphic" result="DILATED" radius="1" />
      <feFlood flood-color="#aa00aa" flood-opacity="1" result="COLORED"></feFlood>
      <feComposite in="COLORED" in2="DILATED" operator="in" result="OUTLINE"></feComposite>

      <feMerge>
        <feMergeNode in="OUTLINE" />
        <feMergeNode in="SourceGraphic" />
      </feMerge>
    </filter>
  </defs>

  <g id="links">
    <!-- LINKS ARE CREATED DYNAMICALLY -->
  </g>

</svg>

<script>
  (function () {
    if (!(document.location + '').includes('localhost')) {
      return;
    }
    function getHash(str) {
      return str.split('').reduce((prevHash, currVal) =>
        (((prevHash << 5) - prevHash) + currVal.charCodeAt(0)) | 0, 0);
    }
    var hash;
    function pageIsChanged() {
      fetch(document.location).then(x => x.text()).then(x => {
        const newHash = getHash(x);
        hash = hash || newHash;

        if (hash === newHash) {
          return;
        }
        document.location.reload();
      });
    }

    console.log('=== Simple Live Reload ===');
    var refreshInterval = setInterval(pageIsChanged, 1000);
  })();
</script>
